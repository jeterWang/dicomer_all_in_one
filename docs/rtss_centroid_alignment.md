# RTSS轮廓质心对齐功能

## 功能描述

RTSS轮廓质心对齐功能是DICOM All-in-One工具中一项新的功能，它可以通过计算RTSS（放射治疗结构集）轮廓的质心来自动推导刚体变换参数。这个功能特别适用于需要将具有相似结构轮廓的两组图像进行对齐的场景，如在不同时间点采集的PET/CT图像的配准。

## 原理说明

1. **质心计算**：对每个RTSS轮廓计算其所有点的几何质心（坐标平均值）。
2. **刚体变换参数计算**：
   - 平移参数(TX, TY, TZ)：通过计算固定图像轮廓质心与移动图像轮廓质心之间的坐标差异得到。
   - 旋转参数：目前仅计算平移，不涉及旋转计算。如需旋转参数，需要更高级的点云配准算法。

## 使用方法

1. 在DICOM All-in-One工具中，切换到"刚体位移"标签页。
2. 加载固定图像目录（包含RTSS）：点击"加载固定图像目录"按钮，选择包含DICOM图像和RTSS的目录。
3. 加载移动图像目录（包含RTSS）：点击"加载移动图像目录"按钮，选择包含DICOM图像和RTSS的目录。
4. 确保两组数据都有RTSS：软件会自动检测和加载RTSS文件，并在信息栏中显示轮廓数量。
5. 计算变换参数：点击"根据轮廓质心计算变换参数"按钮，软件将自动计算质心并推导变换参数。
6. 查看计算结果：计算完成后，平移和旋转参数会自动填充到相应的输入框中。
7. 执行变换：点击"执行刚体变换"按钮应用这些参数进行图像变换。

## 注意事项

1. **RTSS要求**：此功能要求固定图像和移动图像都必须包含RTSS，且RTSS中有至少一个有效的轮廓。
2. **轮廓匹配**：为获得最佳结果，固定图像和移动图像的RTSS应该描述相同或相似的解剖结构。
3. **仅平移变换**：当前版本仅计算平移参数(TX, TY, TZ)，不计算旋转参数(RX, RY, RZ)。
4. **精度限制**：质心对齐法适用于结构形状和大小相近的情况，如果轮廓形状、大小差异较大，可能导致对齐不精确。
5. **手动调整**：自动计算得到的参数只是初始估计，用户可以根据需要手动微调这些参数。

## 应用场景

- PET/CT图像对齐：利用肿瘤、器官轮廓进行不同时间点的PET/CT图像对齐。
- 随访研究：比较同一患者在不同时间点的图像变化。
- 靶区勾画：将一个时间点的轮廓应用到另一个时间点的图像上，作为靶区勾画的参考。

## 技术实现

此功能通过以下步骤实现：

1. 读取DICOM RTSS文件中的轮廓点数据。
2. 遍历每个轮廓的所有点，计算平均坐标值作为质心。
3. 计算固定图像和移动图像轮廓质心的坐标差异。
4. 将差异值作为刚体变换的平移参数。
5. 变换参数可用于SimpleITK实现的图像和轮廓的刚体变换。 